What is the purpose of this lab?

learn how to organise and analyse large datasets using warehousing techniques. These are essential skills for making
informed business decisions, optimising data retrieval, and enhancing understanding of data relationships.

In this lab, I will design a data warehouse for a cloud service provider (CSP). The CSP has given me access to their billing data in the csv file cloud-billing-dataset.csv. The file contains billing data for the past decade. It has the following fields/ columns:

Field Name	    Details
customerid	    Id of the customer
category	    Category of the customer. Example: Individual or Company
country	        Country of the customer
industry	    Which domain/industry the customer belongs to. Example: Legal, Engineering
month	        The billed month, stored as YYYY-MM. Example: 2009-01 refers to the month January in the year 2009
billedamount	Amount charged by the cloud services provided for that month in USD

I need to design a data warehouse that can support the queries listed below:

average billing per customer
billing by country
top 10 customers
top 10 countries
billing by industry
billing by category
billing by year
billing by month
billing by quarter
average billing per industry per month
average billing per industry per quarter
average billing per country per quarter
average billing per country per industry per quarter

Here are five rows picked at random from the csv file. see csv-rows.png

--------------------------------------------------
Designing the fact table(s) for the star schema
--------------------------------------------------

The fact in this data is the bill which is generated monthly. The fields customerid and billedamount are the important fields in the fact table. I also need to identify the additinal customer information, other than the id, and date information. I will fields that refer to the customer and data information in other tables.

The final fact table for the bill would look somehting like this:

Field Name	        Details
billid	            Primary key - Unique identifier for every bill
customerid	        Foreign Key - Id of the customer
monthid	Foreign     Key - Id of the month. We can resolve the billed month info using this
billedamount	    Amount charged by the cloud services provided for that month in USD

There are two dimensions to our fact(monthly bill)

1. customer inforamtion
2. date information

the below fields give information about the customer in a dimension table

Field Name	Details
customerid	Primary Key - Id of the customer
category	Category of the customer. Example: Individual or Company
country	    Country of the customer
industry	Which domain/industry the customer belongs to. Example: Legal, Engineering

the below fields give information about the date of the bill

Field Name	Details
monthid	    Primary Key - Id of the month
year	    Year derived from the month field of the original data. Example: 2010
month	    Month number derived from the month field of the original data. Example: 1, 2, 3
monthname	Month name derived from the month field of the original data. Example: March
quarter	    Quarter number derived from the month field of the original data. Example: 1, 2, 3, 4
quartername	Quarter name derived from the month field of the original data. Example: Q1, Q2, Q3, Q4


Based on the above, I now have 3 tables which are identified below

Table Name	    Type	    Details
FactBilling	    Fact	    This table contains the billing amount, and the foreign keys to customer and month data
DimCustomer	    Dimension	This table contains all the information related the customer
DimMonth	    Dimension	This table contains all the information related the month of billing

Arranging the above tables in star schema style I arrive at a table structure that looks as follows see star-diagram.png

The image shows the fact and dimension tables along with the relationships between them.

------------------------------------------
Creating the schema on the data warehouse
------------------------------------------

this will be done on postgresql server

Firstly, run the command below to set your PostgreSQL password for authentication. Replace <your_password> with your actual PostgreSQL password, and then execute the command:

export PGPASSWORD=<your_password>

Now, run the command below to create a database named billingDW.

createdb -h postgres -U postgres -p 5432 billingDW

In the above command, -h mentions that the database server is accessible using the hostname “postgres”, -U mentions that we are using the user name postgres to log into the database, -p mentions that the database server is running on port number 5432

Download the schema .sql file.

wget https://cf-courses-data.s3.us.cloud-object-storage.appdomain.cloud/IBM-DB0260EN-SkillsNetwork/labs/Working%20with%20Facts%20and%20Dimension%20Tables/star-schema.sql

the above schema is as follows

BEGIN;


CREATE TABLE public."FactBilling"
(
    rowid integer NOT NULL,
    customerid integer NOT NULL,
    monthid integer NOT NULL,
    billedamount integer NOT NULL,
    PRIMARY KEY (rowid)
);

CREATE TABLE public."DimMonth"
(
    monthid integer NOT NULL,
    year integer NOT NULL,
    month integer NOT NULL,
    monthname "char" NOT NULL,
    quarter integer NOT NULL,
    quartername "char" NOT NULL,
    PRIMARY KEY (monthid)
);

CREATE TABLE public."DimCustomer"
(
    customerid integer NOT NULL,
    category "char" NOT NULL,
    country "char" NOT NULL,
    industry "char" NOT NULL,
    PRIMARY KEY (customerid)
);

ALTER TABLE public."FactBilling"
    ADD FOREIGN KEY (customerid)
    REFERENCES public."DimCustomer" (customerid)
    NOT VALID;


ALTER TABLE public."FactBilling"
    ADD FOREIGN KEY (monthid)
    REFERENCES public."DimMonth" (monthid)
    NOT VALID;

END;

Run the command below to create the schema in the under billingDW database.

psql  -h postgres -U postgres -p 5432 billingDW < star-schema.sql




Practice exercise

In this practice exercise, you will analyze the below csv file, which contains data about the daily sales at different stores of an international fashion retailer. see sales-csv.png

Design the schema for the fact table FactSales.

Field Name	Details
rowid	    Primary key - Unique identifier for every row
storeid	    Foreign Key - Id of the store
dateid	    Foreign Key - Id of the date
totalsales	Total sales


Design the schema for the dimension table DimStore.

Field Name	Details
storeid	    Primary key - Unique identifier for every store
city	    City where the store is located.
country	    Country where the store is located.


Design the schema for the dimension table DimDate.

Field Name	    Details
dateid	        Primary Key - Id of the date
day	            Day derived from the date field of the original data. Example: 13, 19
weekday	        Weekday derived from the date field of the original data. Example: 1, 2, 3, 4, 5, 6, 7. 1 for sunday, 7 for saturday
weekdayname	    Weekday name derived from the date field of the original data. Example: Sunday, Monday
year	        Year derived from the date field of the original data. Example: 2010
month	        Month number derived from the date field of the original data. Example: 1, 2, 3
monthname	    Month name derived from the date field of the original data. Example: March
quarter	        Quarter number derived from the date field of the original data. Example: 1, 2, 3, 4
quartername	    Quarter name derived from the date field of the original data. Example: Q1, Q2, Q3, Q4